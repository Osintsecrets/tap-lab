<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFC Tap Lab</title>
  <style>
    :root{--bg:#0f1115;--fg:#e8e9ec;--muted:#a9afc3;--card:#171922;--accent:#7dd3fc;--ok:#34d399;--warn:#fbbf24;--danger:#f87171}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0f1115,#0b0d13);color:var(--fg);font:16px/1.45 system-ui,Segoe UI,Roboto,Inter,Apple Color Emoji,Segoe UI Emoji}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    .badge{padding:6px 10px;border-radius:999px;background:rgba(125,211,252,.12);color:var(--accent);font-weight:600;font-size:12px;letter-spacing:.04em;text-transform:uppercase}
    .card{background:var(--card);border:1px solid #232635;border-radius:16px;padding:18px 20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{font-size:28px;margin:6px 0 0 0}
    h2{margin:22px 0 10px;font-size:18px;color:var(--muted)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    code,kbd{background:#0e111a;border:1px solid #22263a;border-radius:8px;padding:.15em .45em;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:#c7d2fe}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:#0e111a;border:1px solid #1f2333}
    .big{font-size:20px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:#1b2031;border:1px solid #28304a;color:var(--fg);cursor:pointer}
    .btn:hover{background:#212740}
    .muted{color:var(--muted)}
    .hidden{display:none}
    .success{color:var(--ok)}
    .warn{color:var(--warn)}
    .danger{color:var(--danger)}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    footer{opacity:.7;margin-top:24px;font-size:13px}
    .hr{height:1px;background:#22263a;margin:16px 0}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #202538;padding:10px 8px;text-align:left}
    .right{float:right}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <span class="badge">NFC Tap Lab</span>
      <h1 class="big">One URL, many NFC tricks — cross‑platform</h1>
    </header>

    <div id="panel" class="card">
      <div id="landing">
        <p>Drop this site on <strong>GitHub Pages</strong> and encode your tags like <code>https://YOURNAME.github.io/t/&lt;code&gt;</code> (or your custom domain). Each short <em>code</em> triggers a different action that works on both iOS and Android.</p>
        <div class="hr"></div>
        <h2>Demo codes you can use right now</h2>
        <div class="grid">
          <div>
            <div class="pill"><strong>dm</strong> → Instagram DM link</div>
            <div class="pill"><strong>maps</strong> → Open a pinned location</div>
            <div class="pill"><strong>vc</strong> → Download vCard</div>
            <div class="pill"><strong>ics</strong> → Add calendar invite</div>
            <div class="pill"><strong>wifi1</strong> → Show Wi‑Fi QR + creds</div>
            <div class="pill"><strong>beep</strong> → Play a short tone (tap to allow)</div>
            <div class="pill"><strong>r</strong> → Portfolio roulette (random link)</div>
            <div class="pill"><strong>pgp</strong> → Show PGP fingerprint</div>
          </div>
          <div>
            <p class="muted">Try them by appending the code to <code>/t/</code> in your address bar:</p>
            <p class="mono">…/t/dm<br>…/t/maps<br>…/t/vc<br>…/t/ics<br>…/t/wifi1<br>…/t/beep<br>…/t/r<br>…/t/pgp</p>
            <p class="muted">You can also use <code>#/t/&lt;code&gt;</code> if you prefer hash routes.</p>
          </div>
        </div>
        <div class="hr"></div>
        <h2>How to write your NFC tags</h2>
        <ol>
          <li>Open <em>NFC Tools (Pro)</em> → <strong>Write</strong> → <strong>Add record</strong> → <strong>URL/URI</strong>.</li>
          <li>Enter a short URL like <code>https://YOURNAME.github.io/t/vc</code> and write to the tag.</li>
          <li>For longer URLs, use your 215 tags; 213s easily fit these short paths.</li>
        </ol>
        <p class="muted">You can edit the mapping below in the source (see <code>ACTIONS</code>).</p>
      </div>

      <div id="action" class="hidden"></div>
    </div>

    <footer>
      Built for static hosting (GitHub Pages). No apps required. No trackers. Tune the mapping to your brand.
    </footer>
  </div>

  <script>
    // === CONFIG: put your details here ===
    const BRAND = {
      utm: 'nfc',
      ig_dm: 'SocialRiskAudit', // Instagram username for ig.me deep link
      businessPhoneE164: '+972533961190',
      siteBase: 'https://YOURNAME.github.io', // change after deploy (optional)
      pgp: '7C3A 8E6B 92F1 2D21 1B4E  3D2B 9C67 2B6F 4F21 A1BE',
      wifi: { ssid: 'Guest_WiFi', password: 'ChangeMe1234', auth: 'WPA' },
      vcard: {
        given: 'Jeremiah', family: 'Jackson', org: 'Social Risk Audit',
        title: 'OSINT Investigator',
        phone: '+972533961190', email: 'hello@example.com',
        url: 'https://YOURDOMAIN.tld', city: 'Jerusalem', country: 'IL'
      },
      roulette: [
        'https://instagram.com/osintsecrets',
        'https://www.tiktok.com/@guardmyclick',
        'https://example.com/your-best-post'
      ],
      mapsPin: { lat: 31.7767, lng: 35.2345, label: 'SRA Meetup' }
    };

    // === ACTION TABLE ===
    // Define short codes here. Small, memorable codes keep tag URLs short for NTAG213.
    const ACTIONS = {
      dm:   { type:'redirect', url: ()=>`https://ig.me/m/${BRAND.ig_dm}` },
      maps: { type:'redirect', url: ()=>`https://maps.google.com/?q=${BRAND.mapsPin.lat},${BRAND.mapsPin.lng}(${encodeURIComponent(BRAND.mapsPin.label)})` },
      vc:   { type:'downloadVCard' },
      ics:  { type:'downloadICS' },
      wifi1:{ type:'showWifi' },
      beep: { type:'beep' },
      r:    { type:'roulette' },
      pgp:  { type:'showPGP' }
    };

    // === Router ===
    function getCodeFromLocation(){
      const path = location.pathname.replace(/\/+$/,'');
      const hash = location.hash.replace(/^#\/?/,'');
      // support /t/<code> OR #/t/<code>
      const parts = (path.includes('/t/') ? path.split('/t/') : hash.includes('t/') ? hash.split('t/') : []);
      if(parts.length>1){
        let code = parts[1].split('/')[0].trim();
        code = decodeURIComponent(code).toLowerCase();
        return code;
      }
      return null;
    }

    function showLanding(){
      document.getElementById('landing').classList.remove('hidden');
      document.getElementById('action').classList.add('hidden');
    }

    function showAction(html){
      const a = document.getElementById('action');
      a.innerHTML = html;
      a.classList.remove('hidden');
      document.getElementById('landing').classList.add('hidden');
    }

    function withUTM(url, code){
      try{
        const u = new URL(url);
        u.searchParams.set('utm_source','nfc');
        u.searchParams.set('utm_medium','tag');
        u.searchParams.set('utm_campaign', code);
        return u.toString();
      }catch(e){ return url }
    }

    // === Actions ===
    async function runAction(code){
      const def = ACTIONS[code];
      if(!def){
        showLanding();
        return;
      }
      if(def.type==='redirect'){
        const url = typeof def.url==='function'? def.url(): def.url;
        location.replace(withUTM(url, code));
        return;
      }
      if(def.type==='downloadVCard'){
        const v = BRAND.vcard;
        const lines = [
          'BEGIN:VCARD','VERSION:3.0',
          `N:${v.family};${v.given};;;`,`FN:${v.given} ${v.family}`,
          `ORG:${v.org}`,
          v.title?`TITLE:${v.title}`:'',
          `TEL;TYPE=CELL:${v.phone}`,
          `EMAIL;TYPE=INTERNET:${v.email}`,
          `URL:${v.url}`,
          v.city?`ADR;TYPE=WORK:;;${v.city};;${v.country}`:'',
          'END:VCARD'
        ].filter(Boolean).join('\r\n');
        const blob = new Blob([lines+'\r\n'], {type:'text/vcard'});
        const link = URL.createObjectURL(blob);
        showAction(`<h2>Adding contact…</h2><p>Tap the button to download and save.</p><p><a class="btn" href="${link}" download="contact.vcf">Download vCard</a></p>`);
        return;
      }
      if(def.type==='downloadICS'){
        const now = new Date();
        const start = new Date(now.getTime()+72*60*60*1000); // ~3 days ahead
        const end = new Date(start.getTime()+30*60*1000);
        const dt = d=> d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
        const ics = [
          'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//TapLab//EN','CALSCALE:GREGORIAN',
          'BEGIN:VEVENT',
          `UID:${crypto.randomUUID()}`,
          `DTSTAMP:${dt(new Date())}`,
          'SUMMARY:Coffee on me ☕',
          `DTSTART:${dt(start)}`,
          `DTEND:${dt(end)}`,
          'END:VEVENT','END:VCALENDAR'
        ].join('\r\n');
        const blob = new Blob([ics+'\r\n'], {type:'text/calendar'});
        const link = URL.createObjectURL(blob);
        showAction(`<h2>Calendar invite</h2><p>Add this to your calendar:</p><p><a class="btn" href="${link}" download="coffee.ics">Add to Calendar</a></p>`);
        return;
      }
      if(def.type==='showWifi'){
        const {ssid,password,auth} = BRAND.wifi;
        const wifiStr = `WIFI:T:${auth};S:${ssid};P:${password};;`;
        const qr = `https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${encodeURIComponent(wifiStr)}`;
        showAction(`<h2>Guest Wi‑Fi</h2>
          <p class="muted">Scan the QR to join, or enter manually.</p>
          <p><img src="${qr}" alt="Wi‑Fi QR" width="240" height="240" style="border-radius:12px;border:1px solid #232635"/></p>
          <table class="table"><tr><th>SSID</th><td>${ssid}</td></tr><tr><th>Password</th><td>${password}</td></tr><tr><th>Auth</th><td>${auth}</td></tr></table>
        `);
        return;
      }
      if(def.type==='beep'){
        showAction(`<h2>Tap to play</h2><p>Autoplay is blocked on mobile. Tap the button to play a short tone.</p><p><button class="btn" id="play">▶ Play tone</button></p>`);
        document.getElementById('play').addEventListener('click', async ()=>{
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type='sine'; osc.frequency.value=880;
          gain.gain.setValueAtTime(0.0001, ctx.currentTime);
          osc.connect(gain).connect(ctx.destination);
          osc.start();
          gain.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.02);
          gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.35);
          osc.stop(ctx.currentTime+0.4);
        });
        return;
      }
      if(def.type==='roulette'){
        const arr = BRAND.roulette;
        const pick = arr[Math.floor(Math.random()*arr.length)] || BRAND.siteBase;
        location.replace(withUTM(pick, code));
        return;
      }
      if(def.type==='showPGP'){
        showAction(`<h2>PGP fingerprint</h2><p class="mono">${BRAND.pgp}</p><p class="muted">DM me this fingerprint to verify you reached the authentic page.</p>`);
        return;
      }
      showLanding();
    }

    // Init
    const code = getCodeFromLocation();
    if(code){
      runAction(code);
    } else {
      showLanding();
    }
  </script>
</body>
</html>
